mc.Recettes={oninit:function(){var e=this;e.search="",e.filtreIngredients=[],_.each(mc.tagsRecette,function(t){t.selected=!1,t.setSelected=function(r){t.selected=r,e.filtrerList()}}),e.recettesFiltrees=null,e.onSearchChange=function(t){e.search=t,e.filtrerList()},e.filtrerList=function(){if(e.search){var t=[],r=[];_.each(mc.recettes,function(n){var i=n.nomTraduit.toLocaleLowerCase().indexOf(e.search);0===i?t.push(n):i>0&&r.push(n)}),e.recettesFiltrees=t.concat(r)}else e.recettesFiltrees=mc.recettes;if(e.filtreIngredients.length>0){var n=0;_.each(e.filtreIngredients,function(e){e.avec&&n++}),e.recettesFiltrees=_.filter(e.recettesFiltrees,function(t){var r=0;return!_.some(t.ingredients,function(t){var n=t.ingredient,i=_.find(e.filtreIngredients,{ingredient:n});if(i){if(!i.avec)return!0;r++}})&&r==n})}var i=0;_.each(mc.tagsRecette,function(e){e.nombreRecettes=0,e.selected&&i++}),e.recettesFiltrees=_.filter(e.recettesFiltrees,function(e){var t=0;_.each(e.tags,function(e){e.selected&&t++});var r=t==i;return r&&_.each(e.tags,function(e){e.nombreRecettes++}),r})},e.ajouterFiltreIngredient=function(){e.filtreIngredients.push({ingredient:mc.ingredients[0],avec:!0}),e.filtrerList()},e.enleverFiltreIngredient=function(t){e.filtreIngredients.splice(e.filtreIngredients.indexOf(t),1),e.filtrerList()},e.filtrerList()},view:function(e){var t=this;return mc.recettes?m("div#body.recettes.pure-g",[m("div.pure-u-md-6-24.pure-u-1",[m("div#filtre.box",[m(".type",i18n("filterParNom")),m(mc.SearchInput,{callback:t.onSearchChange}),m(".type",i18n("filterParCategorie")),m("div#tags",_.map(mc.tagsRecette,function(e){return m("label",[m("input[type=checkbox]",{onchange:m.withAttr("checked",e.setSelected),checked:e.selected}),e.nomTraduit,m("span.nombre",e.nombreRecettes)])})),m(".type",i18n("filterParIngredient")),_.map(t.filtreIngredients,function(e){return m(mc.Recettes.FiltreIngredient,{filtreIngredient:e,onChange:t.filtrerList,supprimer:t.enleverFiltreIngredient})}),m("input[type=button].ajouter-filtre",{value:i18n("ajouterFiltreIngredient"),onclick:t.ajouterFiltreIngredient})])]),m("div.pure-u-md-18-24.pure-u-1",[m("div#liste.pure-g",_.map(t.recettesFiltrees,function(e){return m(mc.RecetteLink,{key:e._key,recette:e,className:"pure-u-md-8-24 pure-u-1"})}))])]):m(mc.Spinner)}},mc.Recettes.FiltreIngredient={oninit:function(e){var t=this;t.filtreIngredient=e.attrs.filtreIngredient,t.onChange=e.attrs.onChange,t.avecValues=[{value:!0,label:i18n("avec")},{value:!1,label:i18n("sans")}],t.supprimer=function(){e.attrs.supprimer(t.filtreIngredient)}},view:function(){var e=this;return m("div.filtre-ingredient",[m(mc.Select,{selector:".avec-ou-sans",values:e.avecValues,target:e.filtreIngredient,property:"avec",labelField:"label",valueField:"value",onChange:e.onChange}),m(mc.Select,{selector:".ingredient",values:mc.ingredients,target:e.filtreIngredient,property:"ingredient",labelField:"nomTraduit",onChange:e.onChange}),m("div.remove-button",[m("i.fa.fa-times",{style:"cursor:pointer",onclick:e.supprimer})])])}};